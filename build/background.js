(()=>{"use strict";const t=class{constructor(t,e){this._con=t,this._fetch=e,this._status=null,e.then((t=>{this._status=t.status}))}abort(){this._con.abort()}get status(){return this._status}async _request(){return(await this._fetch).clone()}async valid(){return await this._fetch,this}};for(const e of["text","json","blob","arrayBuffer","formData"])t.prototype[e]=async function(){return await(await this._request())[e]()};const e=/\/catalog\/g\/g([MKPBRSICT]-\d{5})/;chrome.runtime.onInstalled.addListener((({})=>{chrome.storage.local.set({__akizuki_current_item_id:""})})),chrome.contextMenus.create({id:"__akizuki_right_click",title:"リンク先を買い物リストに追加する",contexts:["link"]},(()=>chrome.runtime.lastError)),chrome.contextMenus.onClicked.addListener((async t=>{if(console.log(t),"__akizuki_right_click"==t.menuItemId){const s=t.linkUrl.match(e)?.[1];if(!s)return null;const[a]=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(a.id,{name:"add_item",payload:{id:s}}).catch(console.log)}}));const s=t=>{chrome.tabs.get(t?.tabId||t,(t=>{const{url:s}=t,a=s.match(e)?.[1];chrome.storage.local.set({__akizuki_current_item_id:a||""})}))};chrome.tabs.onActivated.addListener(s),chrome.tabs.onUpdated.addListener(s)})();